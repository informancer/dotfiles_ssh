#!/usr/bin/env bash
# -*- sh -*-

usage() { echo "Usage: $(basename $0) <user> <hostname>" 1>&2; }

if [ $# -ne 2 ]; then
    usage;
    exit 64;
fi

user=$1
host=$2

confdir="$HOME/.ssh/config.d"
confname="${confdir}/${user}@${host}.config"

if [ -f "${confname}" ]; then
   echo "File \"${confname}\" already exists"
   exit 1
fi

echo create a new key for $user@$host

echo ${confdir}
mkdir -p ${confdir}

echo $confname

cat <<EOF > $confname
Match User ${user} Host ${host}
  IdentityFile ~/.ssh/${user}@${host}
EOF
